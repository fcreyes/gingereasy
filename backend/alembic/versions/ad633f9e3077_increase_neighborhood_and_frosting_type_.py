"""increase_neighborhood_and_frosting_type_limits

Revision ID: ad633f9e3077
Revises:
Create Date: 2025-12-08 02:47:53.407841

"""

from collections.abc import Sequence

import sqlalchemy as sa

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "ad633f9e3077"
down_revision: str | Sequence[str] | None = None
branch_labels: str | Sequence[str] | None = None
depends_on: str | Sequence[str] | None = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###

    # Increase column sizes
    op.alter_column(
        "listings",
        "neighborhood",
        existing_type=sa.VARCHAR(length=100),
        type_=sa.String(length=200),
        existing_nullable=True,
    )
    op.alter_column(
        "listings",
        "frosting_type",
        existing_type=sa.VARCHAR(length=100),
        type_=sa.String(length=500),
        existing_nullable=True,
    )

    # Update NULL values to defaults before adding NOT NULL constraints
    op.execute("UPDATE listings SET has_gumdrop_garden = 0 WHERE has_gumdrop_garden IS NULL")
    op.execute("UPDATE listings SET listing_type = 'cottage' WHERE listing_type IS NULL")
    op.execute("UPDATE listings SET status = 'available' WHERE status IS NULL")
    op.execute("UPDATE users SET is_active = 1 WHERE is_active IS NULL")

    # Add NOT NULL constraints
    op.alter_column("listings", "has_gumdrop_garden", existing_type=sa.INTEGER(), nullable=False)
    op.alter_column("listings", "listing_type", existing_type=sa.VARCHAR(length=50), nullable=False)
    op.alter_column("listings", "status", existing_type=sa.VARCHAR(length=50), nullable=False)
    op.alter_column("users", "is_active", existing_type=sa.INTEGER(), nullable=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column("users", "is_active", existing_type=sa.INTEGER(), nullable=True)
    op.alter_column("listings", "status", existing_type=sa.VARCHAR(length=50), nullable=True)
    op.alter_column("listings", "listing_type", existing_type=sa.VARCHAR(length=50), nullable=True)
    op.alter_column(
        "listings",
        "frosting_type",
        existing_type=sa.String(length=500),
        type_=sa.VARCHAR(length=100),
        existing_nullable=True,
    )
    op.alter_column("listings", "has_gumdrop_garden", existing_type=sa.INTEGER(), nullable=True)
    op.alter_column(
        "listings",
        "neighborhood",
        existing_type=sa.String(length=200),
        type_=sa.VARCHAR(length=100),
        existing_nullable=True,
    )
    # ### end Alembic commands ###
